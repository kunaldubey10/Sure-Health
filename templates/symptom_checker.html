{% extends "base.html" %}

{% block title %}Symptom Checker - Sure Health{% endblock %}

{% block content %}
<section class="section bg-light-blue py-4">
    <div class="container">
        <div class="text-center">
            <h1 class="section-title mb-2">AI Symptom Checker</h1>
            <p class="section-subtitle">Get preliminary insights about your symptoms (Not a substitute for professional medical advice)</p>
        </div>
    </div>
</section>

<section class="section">
    <div class="container">
        <div class="alert alert-warning">
            <h5><i class="fas fa-exclamation-triangle me-2"></i> Important Disclaimer</h5>
            <p class="mb-0">This symptom checker is for informational purposes only and is not a substitute for professional medical advice, diagnosis, or treatment. If you have severe symptoms or a medical emergency, call 911 immediately.</p>
        </div>
        
        <div class="row mt-4">
            <div class="col-lg-8 mx-auto">
                <div class="card shadow-custom">
                    <div class="card-body p-4">
                        <h5 class="mb-4"><i class="fas fa-notes-medical me-2"></i> Describe Your Symptoms</h5>
                        
                        <form id="symptomForm">
                            <div class="mb-3">
                                <label class="form-label">Primary Symptoms (Select all that apply)</label>
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="fever" id="fever">
                                            <label class="form-check-label" for="fever">Fever</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="cough" id="cough">
                                            <label class="form-check-label" for="cough">Cough</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="headache" id="headache">
                                            <label class="form-check-label" for="headache">Headache</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="sore throat" id="soreThroat">
                                            <label class="form-check-label" for="soreThroat">Sore Throat</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="chest pain" id="chestPain">
                                            <label class="form-check-label" for="chestPain">Chest Pain</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="shortness of breath" id="breathing">
                                            <label class="form-check-label" for="breathing">Shortness of Breath</label>
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="nausea" id="nausea">
                                            <label class="form-check-label" for="nausea">Nausea</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="fatigue" id="fatigue">
                                            <label class="form-check-label" for="fatigue">Fatigue</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="dizziness" id="dizziness">
                                            <label class="form-check-label" for="dizziness">Dizziness</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="body aches" id="bodyAches">
                                            <label class="form-check-label" for="bodyAches">Body Aches</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="skin rash" id="rash">
                                            <label class="form-check-label" for="rash">Skin Rash</label>
                                        </div>
                                        <div class="form-check">
                                            <input class="form-check-input" type="checkbox" value="abdominal pain" id="abdominalPain">
                                            <label class="form-check-label" for="abdominalPain">Abdominal Pain</label>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="mb-3">
                                <label for="duration" class="form-label">How long have you had these symptoms?</label>
                                <select class="form-select" id="duration">
                                    <option value="">Select duration...</option>
                                    <option value="less than 24 hours">Less than 24 hours</option>
                                    <option value="1-3 days">1-3 days</option>
                                    <option value="4-7 days">4-7 days</option>
                                    <option value="1-2 weeks">1-2 weeks</option>
                                    <option value="more than 2 weeks">More than 2 weeks</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="severity" class="form-label">Symptom Severity</label>
                                <select class="form-select" id="severity">
                                    <option value="">Select severity...</option>
                                    <option value="mild">Mild - Manageable discomfort</option>
                                    <option value="moderate">Moderate - Affecting daily activities</option>
                                    <option value="severe">Severe - Significantly impacting life</option>
                                </select>
                            </div>
                            
                            <div class="mb-3">
                                <label for="additionalInfo" class="form-label">Additional Information</label>
                                <textarea class="form-control" id="additionalInfo" rows="3" placeholder="Describe any other relevant symptoms or concerns..."></textarea>
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-100">
                                <i class="fas fa-search me-2"></i> Analyze Symptoms
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Results Section -->
        <div class="row mt-5" id="resultsSection" style="display: none;">
            <div class="col-lg-10 mx-auto">
                <div class="result-box">
                    <h3 class="text-center mb-4">Symptom Analysis Results</h3>
                    
                    <div id="severityAlert" class="alert mb-4"></div>
                    
                    <h5 class="mb-3">Possible Conditions:</h5>
                    <div id="conditionsContainer" class="mb-4"></div>
                    
                    <h5 class="mb-3">Recommendations:</h5>
                    <div id="recommendationsContainer" class="mb-4"></div>
                    
                    <div class="text-center mt-4">
                        <a href="{{ url_for('appointments') }}" class="btn btn-primary me-2">
                            <i class="fas fa-calendar-check me-2"></i> Book Doctor Appointment
                        </a>
                        <a href="{{ url_for('emergency') }}" class="btn btn-danger me-2">
                            <i class="fas fa-ambulance me-2"></i> Emergency Resources
                        </a>
                        <button class="btn btn-outline-primary" onclick="resetSymptoms()">
                            <i class="fas fa-redo me-2"></i> Check Again
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script>
document.getElementById('symptomForm').addEventListener('submit', async function(e) {
    e.preventDefault();
    
    const symptoms = [];
    document.querySelectorAll('input[type="checkbox"]:checked').forEach(cb => {
        symptoms.push(cb.value);
    });
    
    if (symptoms.length === 0) {
        alert('Please select at least one symptom.');
        return;
    }
    
    const data = {
        symptoms: symptoms,
        duration: document.getElementById('duration').value,
        severity: document.getElementById('severity').value,
        additionalInfo: document.getElementById('additionalInfo').value
    };
    
    try {
        const response = await fetch('/check-symptoms', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(data)
        });
        
        const result = await response.json();
        
        if (result.success) {
            displayAnalysis(result.analysis);
        } else {
            alert('Error: ' + result.error);
        }
    } catch (error) {
        alert('Error: ' + error.message);
    }
});

function displayAnalysis(analysis) {
    // Display severity alert
    const severityAlert = document.getElementById('severityAlert');
    if (analysis.severity === 'high') {
        severityAlert.className = 'alert alert-danger';
        severityAlert.innerHTML = '<h5><i class="fas fa-exclamation-circle me-2"></i> High Severity</h5><p class="mb-0">Your symptoms may require immediate medical attention. Please consult a healthcare provider as soon as possible.</p>';
    } else if (analysis.severity === 'moderate') {
        severityAlert.className = 'alert alert-warning';
        severityAlert.innerHTML = '<h5><i class="fas fa-exclamation-triangle me-2"></i> Moderate Severity</h5><p class="mb-0">Your symptoms should be evaluated by a healthcare provider. Consider scheduling an appointment.</p>';
    } else {
        severityAlert.className = 'alert alert-info';
        severityAlert.innerHTML = '<h5><i class="fas fa-info-circle me-2"></i> Mild Severity</h5><p class="mb-0">Your symptoms appear to be mild. Monitor your condition and seek medical attention if symptoms worsen.</p>';
    }
    
    // Display possible conditions
    const conditionsContainer = document.getElementById('conditionsContainer');
    conditionsContainer.innerHTML = '';
    analysis.possible_conditions.forEach(condition => {
        conditionsContainer.innerHTML += `
            <div class="card mb-2">
                <div class="card-body py-2">
                    <i class="fas fa-circle me-2" style="font-size: 0.5rem; color: var(--primary-blue);"></i>
                    ${condition}
                </div>
            </div>
        `;
    });
    
    // Display recommendations
    const recommendationsContainer = document.getElementById('recommendationsContainer');
    recommendationsContainer.innerHTML = '';
    analysis.recommendations.forEach(recommendation => {
        recommendationsContainer.innerHTML += `
            <div class="card mb-2">
                <div class="card-body py-2">
                    <i class="fas fa-check-circle me-2" style="color: var(--success-green);"></i>
                    ${recommendation}
                </div>
            </div>
        `;
    });
    
    document.getElementById('resultsSection').style.display = 'block';
    document.getElementById('resultsSection').scrollIntoView({ behavior: 'smooth' });
}

function resetSymptoms() {
    document.getElementById('symptomForm').reset();
    document.getElementById('resultsSection').style.display = 'none';
    window.scrollTo({ top: 0, behavior: 'smooth' });
}
</script>
{% endblock %}
